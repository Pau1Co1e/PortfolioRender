<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fractal Dimension Calculator</title>
    <link rel="icon" type="image/webp" href="images/logo_new.webp">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://code.jquery.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;">
    <link href="css/style.min.css" rel="stylesheet">
</head>
<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html"><img src="images/logo_new.webp" alt="Paul Coleman Logo" height="40"></a>
            <a class="navbar-brand text-uppercase" href="index.html">Portfolio</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'about_me' %}active{% endif %}" href="about_me.html">About Me</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'experience' %}active{% endif %}" href="experience.html">Projects</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'contact_me' %}active{% endif %}" href="contact_me.html">Contact Me</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'download' %}active{% endif %}" href="download.html">Downloads</a>
                    </li>
                   </ul>
                <button id="darkModeToggle" class="btn btn-secondary ms-auto" type="button">Toggle Dark Mode</button>
            </div>
        </div>
    </nav>
</header>

<body class="fractal_body">

    <main>
        <section>
            <div class="alert alert-secondary" role="alert">
                <p><strong>Instructions:</strong> Upload a high-contrast image to calculate its fractal dimension. The tool works best with images that have clear, distinguishable features.</p>
            </div>

            <div>
                <form id="fractal-form" enctype="multipart/form-data">
                    <label for="file">Upload an image:</label>
                    <input type="file" name="file" id="file" required>
                    <button type="submit">Calculate Fractal Dimension</button>
                </form>
            </div>

            <div class="loader" id="loading-spinner" style="display: none;"></div>

            <div id="result"></div>
        </section>
    </main>

    <footer class="bg-light text-center text-lg-start mt-5">
        <div class="container p-4">
            <div class="row">
            <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase">Quick Links</h5>

                <ul class="list-unstyled mb-0">
                    <li>
                        <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li>
                        <a class="nav-link {% if request.endpoint == 'about_me' %}active{% endif %}" href="about_me.html">About Me</a>
                    </li>
                    <li>
                        <a class="nav-link {% if request.endpoint == 'projects' %}active{% endif %}" href="experience.html">Projects</a>
                    </li>
                    <li>
                        <a class="nav-link {% if request.endpoint == 'contact_me' %}active{% endif %}" href="contact_me.html">Contact Me</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'download' %}active{% endif %}" href="download.html">Downloads</a>
                    </li>
                </ul>
            </div>
            <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase">Follow Me</h5>
                <ul class="list-unstyled mb-0">
                    <li><a href="https://www.linkedin.com/in/paulc88" class="text-dark">LinkedIn</a></li>
                    <li><a href="https://colemantech.netlify.app" class="text-dark">Portfolio</a></li>
                    <li><a href="https://github.com/Pau1Co1e/" class="text-dark">GitHub</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
        Â© 2024 Paul Coleman. All rights reserved.
    </div>

</footer>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha384-1H217gwSVyLSIfaLxHbE7dRb3v4mYCKbpQvzx0cegeju1MVsGrX5xXxAvs/HgeFs" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <script src="js/spinner.js"></script>
    <script>
        $('form').on('submit', function(event) {
        event.preventDefault();  // Prevent the form from submitting normally
        const fileInput = document.getElementById('file');
        const file = fileInput.files[0];

        if (!file) {
            alert('Please select a file.');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        $.ajax({
            url: '/.netlify/functions/fractal',  // Ensure this is pointing to your Netlify function
            type: 'POST',
            data: formData,
            contentType: false,  // Let jQuery handle the content type
            processData: false,  // Don't process the data
            success: function(response) {
                console.log("Raw response:", response);
                const data = typeof response === "string" ? JSON.parse(response) : response;
                console.log("Parsed data:", data);
                if (data.fractalDimension !== undefined) {
                    console.log(this.success)
                    alert("Fractal Dimension: " + data.fractalDimension);
                } else {
                    console.error("Fractal Dimension is undefined");
                    alert("Error: Fractal Dimension is undefined.");
                }
            },
            error: function(xhr, status, error) {
                $('#loading-spinner').hide();
                console.error("Status: " + status);
                console.error("Error: " + error);
                console.error("Response Text: " + xhr.responseText);
                alert("Error calculating fractal dimension.");
            }
        });
    });
    </script>
    <script>
        $(document).ready(function() {
            const path = window.location.pathname.split("/").pop();
            $('.navbar-nav .nav-item a').each(function() {
                const href = $(this).attr('href');
                if (path === href) {
                    $(this).addClass('active');
                }
            });
        });
    </script>
</body>
</html>